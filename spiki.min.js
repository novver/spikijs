const spiki=(()=>{const a=Object,b=Array,d=Reflect,c=document,e="prototype",f="length",g="value",h="forEach",i="split",j="slice",k="push",l="call",m="hasOwnProperty",n="delete",o="clear",q="hasAttribute",r="getAttribute",s="removeAttribute",t="replaceWith",u="cloneNode",v="insertBefore",w="remove",x="addEventListener",y="createTextNode",z="parentNode",A="nextSibling",B="firstElementChild",C="checked",D="tagName",E="type",F=a.create(null),G=new WeakMap,H=new WeakMap,I=new WeakMap,J=new Map,K=new Set;let L,M,N,O=!0,P=Promise.resolve();const p=(a,b)=>O&&H.get(a)?.get(b)?.[h](a=>a.x?a.x(a):a()),Q={};["push","pop","shift","unshift","splice","sort","reverse"].forEach(a=>Q[a]=function(...c){O=!1;try{return b[e][a]["apply"](this,c)}finally{O=!0,p(this,f)}});const R=(a,b)=>{if("string"!=typeof b)return{val:b,ctx:a};let c=J.get(b);c||(999<J.size&&J[o](),J.set(b,c=b[i](".")));let d=a,e=a;for(const f of c){if(null==d)return{val:d,ctx:null};d=(e=d)[f]}return{val:d,ctx:e}},S=(a,b,c)=>{const{val:d,ctx:e}=R(a,b);return"function"==typeof d?d[l](e,c):d},T=a=>!K.has(a)&&K.add(a)&&!M&&(M=!0)&&P.then(()=>(K[h](a=>a()),K[o](),M=!1)),U=(a,b)=>{const c=()=>{c.d[h](a=>a[n](c)),c.d[o]();const b=L;L=c;try{a()}finally{L=b}};return c.d=new Set,c.x=b,c(),()=>(c.d[h](a=>a[n](c)),c.d[o](),K[n](c))},V=c=>!c||"object"!=typeof c||c._p||c instanceof Node?c:I.get(c)||I.set(c,new Proxy(c,{get:(c,f,g)=>{if("_p"===f)return!0;if(b.isArray(c)&&a[e][m][l](Q,f))return Q[f];if(L){let a=H.get(c)??H.set(c,new Map).get(c);(a.get(f)??a.set(f,new Set).get(f)).add(L),L.d.add(a.get(f))}const h=d.get(c,f,g);return h&&"object"==typeof h&&!(h instanceof Node)?V(h):h},set:(c,g,h,i)=>{const j=b.isArray(c),k=c[g],n=j?+g<c[f]:a[e][m][l](c,g),o=d.set(c,g,h,i);if(O&&(n?k!==h&&p(c,g):(p(c,g),j&&p(c,f))));return o},deleteProperty:(c,g)=>{const h=a[e][m][l](c,g),i=d["deleteProperty"](c,g);return i&&h&&(p(c,g),b.isArray(c)&&p(c,f)),i}})).get(c);N=V({});const W={text:(a,b)=>a["textContent"]=b??"",html:(a,b)=>a["innerHTML"]=b??"",value:(a,b)=>"checkbox"===a[E]?a[C]=!!b:"radio"===a[E]&&a.name?a[C]=a[g]==b:a[g]!=b&&(a[g]=b??""),attr:(a,b,c)=>null==b||!1===b?a[s](c):a["setAttribute"](c,!0===b?"":b),class:(a,b)=>"string"==typeof b&&b[i](/\s+/)[h](b=>b&&a["classList"]["!"===b[0]?"remove":"add"]("!"===b[0]?b[j](1):b)),init:()=>{},destroy:()=>{}},X=o=>{if(o._m)return;o._m=1;const p=F[o[r]("s-data")];if(!p)return;const I=V(p());I.$refs={},I.$root=o,I.$store=N;const J=[],K=a=>{let b=a.target;if(b._m&&("input"===a[E]||"change"===a[E])){const a=b._m,c="checkbox"===b[E]?b[C]:b[g],{ctx:d}=R(b._s||I,a);-1===a.indexOf(".")?(b._s||I)[a]=c:d&&(d[a[i](".").pop()]=c)}for(let c;b&&b!==o[z];){if(c=G.get(b)?.[a[E]]){const{val:d,ctx:e}=R(b._s||I,c);"function"==typeof d&&d[l](e,a)}b=b[z]}},M=(g,p,C)=>{if(1!==g["nodeType"]||g[q]("s-ignore"))return;if(g!==o&&g[q]("s-data"))return C[k](X(g).unmount),void 0;let F;if(F=g[r]("s-if")){const a=c[y](""),b=[];g[t](a);let d;return C[k](()=>b[h](a=>a())),C[k](U(()=>{S(p,F,g)?!d&&(d=g[u](!0),d[s]("s-if"),M(d,p,b),a[z][v](d,a)):d&&(b[h](a=>a()),b[f]=0,d[w](),d=null)},T))}if("TEMPLATE"===g[D]&&(F=g[r]("s-for"))){const j=F["match"](/^\s*(.*?)\s+in\s+(.+)\s*$/);if(!j)return;const[o,q]=[j[1]["replace"](/[()]/g,""),j[2]],[s,x]=o[i](",").map(a=>a["trim"]()),D=g[r]("s-key"),E=c[y]("");g[t](E);let G=new Map;return C[k](()=>G[h](a=>a.k[h](a=>a()))),C[k](U(()=>{const{val:j}=R(p,q);if(b.isArray(j)&&L){let a=H.get(j)??H.set(j,new Map).get(j);(a.get(f)??a.set(f,new Set).get(f)).add(L),L.d.add(a.get(f))}let o=E,r=new Map;(b.isArray(j)?j:j?a.keys(j):[])[h]((q,t)=>{const[i,w]=b.isArray(j)?[t,q]:[q,j[q]],y=D&&w?w[D]:"object"==typeof w&&w?w:i+"_"+w;let C=G.get(y);const E=b=>a["defineProperty"](b,s,{configurable:!0,enumerable:!0,get:()=>j[i],set:a=>j[i]=a});if(!C){const b=g["content"][u](!0),c=a.create(p),f=[],h=new Proxy(c,{set:(b,f,g)=>{if(a[e][m][l](b,f))return d.set(b,f,g);let h=b;for(;h&&!a[e][m][l](h,f);)h=a["getPrototypeOf"](h);return d.set(h||b,f,g)}});E(h),x&&(h[x]=i);const j=[];for(let a=b[B];a;){j[k](a);const b=a[A];M(a,h,f),a=b}C={n:j,s:h,k:f}}else E(C.s),x&&(C.s[x]=i);if(C.n[0]!==o[A]){const a=c["createDocumentFragment"]();C.n[h](b=>a["appendChild"](b)),o[z][v](a,o[A])}o=C.n[C.n[f]-1],r.set(y,C),G[n](y)}),G[h](a=>(a.k[h](a=>a()),a.n[h](a=>a[w]()))),G=r},T))}const J=g.attributes;for(let a=J[f]-1;0<=a;a--){const{name:b,value:c}=J[a];if(":"===b[0])C[k](U(()=>W["class"===b[j](1)?"class":"attr"](g,S(p,c,g),b[j](1)),T));else if(b.startsWith("s-")){const a=b[j](2);if("ref"===a)I.$refs[c]=g;else if("model"!==a)W[a]?C[k](U(()=>W[a](g,S(p,c,g)),T)):(g._s=p,(G.get(g)??G.set(g,{}).get(g))[a]=c,!o._e?.has(a)&&(o._e??=new Set).add(a)&&o[x](a,K));else if(C[k](U(()=>W.value(g,R(p,c).val),T)),/^(INPUT|SELECT|TEXTAREA)$/.test(g[D])){g._s=p,g._m=c;const a="checkbox"===g[E]||"radio"===g[E]||"SELECT"===g[D]?"change":"input";!o._e?.has(a)&&(o._e??=new Set).add(a)&&o[x](a,K)}}}for(let a=g[B];a;){const b=a[A];M(a,p,C),a=b}};return M(o,I,J),I.init?.(),{unmount:()=>(I.destroy?.call(I),J[h](a=>a()),o._e?.[h](a=>o["removeEventListener"](a,K)),o._m=0)}};return{data:(a,b)=>F[a]=b,start:()=>c["querySelectorAll"]("[s-data]")[h](X),store:(a,b)=>b===void 0?N[a]:N[a]=b}})();export default spiki;
